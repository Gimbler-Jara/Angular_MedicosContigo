<div class="perfil-container">
    <!-- Panel izquierdo con datos del médico -->
    <aside class="perfil-panel">
        <div class="perfil-card">
            <i class="fas fa-user-circle perfil-icon"></i>
            <h3><i class="fa-solid fa-user-doctor"></i> Dr. {{usuario.firstName}} {{usuario.lastName}}</h3>
            <p><i class="fa-solid fa-id-badge"></i> CMP: 123456</p>
            <p><i class="fa-solid fa-envelope"></i> {{usuario.email}}</p>
            <p><i class="fa-solid fa-phone"></i> +51 {{usuario.telefono}}</p>
        </div>
    </aside>

    <div class="perfil-lateral">

    </div>

    <!-- Panel derecho con menú y contenido -->
    <div class="perfil-derecha">
        <div class="menu-opciones">
            <button [class.active]="vista === 'citas'" (click)="cambiarVista('citas')">Ver citas por atender</button>
            <button [class.active]="vista === 'agregar'" (click)="cambiarVista('agregar')">Agregar disponibilidad de
                cita</button>
            <button [class.active]="vista === 'eliminar'" (click)="cambiarVista('eliminar')">Gestionar
                disponibilidad</button>
        </div>

        <div class="contenido">

            <!-- Vista de citas -->
            @if (vista === 'citas') {
            <h3>Citas programadas</h3>

            <!-- Filtro -->
            <div class="filtro-citas">
                <label for="filtroDia"><i class="fa-solid fa-filter"></i> Filtrar por día:</label>
                <select id="filtroDia" [(ngModel)]="filtroDia" (change)="filtrarCitasPorDia()">
                    <option value="">-- Todos --</option>
                    @for (dia of diasSemana; track $index) {
                    <option [value]="dia">{{ dia }}</option>
                    }
                </select>
            </div>


            @if (citasFiltradas.length) {
            <table class="tabla-citas">
                <thead>
                    <tr>
                        <th style="text-align: center;">Fecha</th>
                        <th style="text-align: center;">Hora</th>
                        <th style="text-align: center;">Paciente</th>
                        <th style="text-align: center;">Estado de cita</th>
                        <th style="text-align: center;">Marcar como atendido</th>
                    </tr>
                </thead>
                <tbody>
                    @for (cita of citasFiltradas; track $index) {
                    <tr>
                        <td style="text-align: center;">{{ cita.fecha | date:'yyyy-MM-dd' }}</td>
                        <td style="text-align: center;">{{ cita.hora }}</td>
                        <td style="text-align: center;">{{ cita.pacienteNombre }}</td>
                        <td style="text-align: center;"><span class="estado {{ cita.estado }}">{{ cita.estado }}</span>
                        </td>
                        <td style="text-align: center;">
                            <a (click)="marcarcitaComoAtendido(cita.id)" class=" btn-atendido">Atendido<i
                                    class="fa-solid fa-check-to-slot"></i></a>
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
            }@else {
            <p>No hay citas programadas para el filtro seleccionado.</p>
            }
            }

            <!-- Agregar disponibilidad -->
            @if (vista === 'agregar') {
            <div class="disponibilidad-form">
                <h3><i class="fa-solid fa-calendar-plus"></i> Agregar disponibilidad</h3>

                <div class="form-row">
                    <label for="dia">Día de la semana:</label>
                    <select id="dia" [(ngModel)]="nuevaDisponibilidad.dia">
                        <option value="" disabled selected>Seleccione el dia</option>
                        @for (dia of diasSemana; track $index) {
                        <option [value]="dia">{{ dia }}</option>
                        }
                    </select>
                </div>

                <div class="form-row">
                    <label for="hora">Hora:</label>
                    <select id="hora" [(ngModel)]="nuevaDisponibilidad.hora">
                        <option value="" disabled selected>Seleccione la hora</option>
                        @for (hora of horas; track $index) {
                        <option [value]="hora">{{ hora }}</option>
                        }
                    </select>
                </div>

                <button class="btn-agregar" (click)="agregarDisponibilidad()">
                    <i class="fa-solid fa-plus"></i> Agregar
                </button>
            </div>
            }


            <!-- Eliminar disponibilidad -->
            @if (vista === 'eliminar') {
            <div class="disponibilidad-eliminar">
                <h3><i class="fa-solid fa-calendar-xmark"></i> Disponibilidad de Citas</h3>
                <ul>
                    @if (disponibilidades.length) {
                    @for (dispo of disponibilidades; track $index) {
                    <li>
                        {{ dispo.dia }} - {{ dispo.hora }}
                        @if (dispo.activo) {
                        <button class="visible"
                            (click)="ocultarDisponibilidad(dispo.idHora, dispo.idDia, dispo.activo)">
                            <i class="fa-solid fa-eye"></i>
                        </button>
                        }@else {
                        <button class="hidden" (click)="ocultarDisponibilidad(dispo.idHora, dispo.idDia, dispo.activo)">
                            <i class="fa-solid fa-eye-slash"></i>
                        </button>
                        }
                    </li>
                    }
                    }@else {
                    <p>No hay disponiblidad de horarios registrada.</p>
                    }
                </ul>
            </div>
            }

        </div>
    </div>
</div>